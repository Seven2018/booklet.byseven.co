<div id="show-controls" class='flex-row-between-centered'>
  <%= link_to catalogue_path, class: 'btn return-arrow' do %><i class='fas fa-arrow-left'></i><% end %>
  <div id='show-buttons'>
    <%= link_to view_content_path(@content), class: 'btn btn-edit-white btn-icon' do %>
      <i class="far fa-eye"></i>
    <% end %>
    <% if ['Super Admin', 'Admin', 'HR', 'Manager'].include? current_user.access_level %>
      <%= link_to edit_content_path(@content) do %>
        <button class='btn-edit-white btn-icon'><i class='fas fa-pen'></i></button>
      <% end %>
      <a data-toggle='modal' data-target='#editCategory'><button class='btn-edit-white btn-icon'><i class="fas fa-swatchbook"></i></button></a>
      <%= link_to content_path(@content), method: :delete, data: { confirm: 'Are you sure ?'} do %>
        <button class='btn-edit-white btn-icon btn-last'><i class="far fa-trash-alt"></i></button>
      <% end %>
    <% end %>
  </div>
</div>
<div id="container-show">
  <div class='content-show-type'>
    <h3>Content</h3>
  </div>
  <div class='content-show-card'>
    <div class='content-show-card-main flex-column-centered'>
      <h1><%= @content.title %></h1>
      <div id='content-show-author'>
        <% if ['Super Admin', 'Admin', 'HR', 'Manager'].include? current_user.access_level %>
          <h3 onclick="openForm(this);">By <%= @content.author.firstname %></h3>
          <!-- <div class='icon-btn' onclick="openForm(this);">
            <i class="fas fa-pencil-alt"></i>
          </div> -->
          <div class='hidden hidden-form-ajax'>
            <%= form_with url: change_author_path, id: 'author_form', local: true, method: :get do |f| %>
              <%= f.hidden_field :ajax, value: true %>
              <%= f.hidden_field :user_id %>
              <%= f.hidden_field :content_id, value: @content.id %>
              <%= f.text_field :search, placeholder: 'Search Users', label: false, data: {behavior: 'autocomplete'} %>
            <% end %>
          </div>
        <% else %>
          <h3>By <%= @content.author.firstname %></h3>
        <% end %>
      </div>
      <img src='<%= @content.author.picture %>' alt="" class='avatar-large-content-card' onerror='this.onerror=null;this.src="<%= asset_url('empty-avatar.png', type: :image) %>";'>
      <p><%= "#{@content.duration} min" %></p>
    </div>
    <div class="content-show-card centered-item">
      <div>
        <p><%= @content.description %></p>
      </div>
    </div>
    <div class="content-show-card-footer  centered-item">
      <button class='booking-btn btn-last'><%= link_to 'Book', book_content_path(@content, content_id: @content.id) %></button>
    </div>
  </div>
  <% if ['Super Admin', 'Admin', 'HR', 'Manager'].include? current_user.access_level %>
    <div class="content-show-module-controls flex-row-between-centered">
      <h3><b>Modules</b></h3>
      <div class="flex-row-between-centered">
        <a data-toggle='modal' data-target='#editContentContent'>
        <button class='icon-btn'><i class="far fa-clipboard"></i></button>
        </a>
        <div id='mod-create-assessment-div' class='centered-item'>
          <button id='mod-create-assessment-button' class='icon-btn'>
            <i class="fas fa-tasks"></i>
          </button>
          <div id='mod-create-assessment-form' style='display: none;'>
            <%= simple_form_for Assessment.new do |f| %>
              <div class='flex-row-between-centered'>
                <%= f.text_field :title, placeholder: 'Quiz title', style: 'height: 100%;' %>
                <%= button_tag :submit, name: 'content_id', value: "#{@content.id}", class: 'btn btn-edit-white btn-icon' do %>
                  <i class="fas fa-save"></i>
                <% end %>
              </div>
            <% end %>
          </div>
          <script>
            $('#mod-create-assessment-button').click(function(event){
              event.preventDefault();
              $(this).hide();
              $(this).parent().children('#mod-create-assessment-form').show();
            });
          </script>
        </div>
      </div>
    </div>
  <% else %>
    <div class="content-show-module-controls flex-row-start-centered">
      <h3>Modules</h3>
    </div>
  <% end %>
  <div id="content-show-module-index">

  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/easy-autocomplete/1.3.5/jquery.easy-autocomplete.min.js"></script>

<script>
  function openForm(element) {
    element.classList.toggle('hidden');
    element.parentNode.querySelector('.hidden-form-ajax').classList.toggle('hidden');
  }

  $input = $("[data-behavior='autocomplete']");

  var options = {
    listLocation: "users",
    getValue: 'name',
    url: function(phrase) {
      return "/users_search.json?search=" + phrase
    },
    list: {
      onChooseEvent: function() {
        var id = $input.getSelectedItemData().id;
        $('#user_id').val(id);
        $('#author_form').submit();
      },
      match: {
        enabled: true
      }
    }
  }


  $input.easyAutocomplete(options);
</script>
