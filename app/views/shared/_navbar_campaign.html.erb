<div class="navbar navbar-expand-sm navbar-light navbar__blue">
  <div class="navbar-controls__left">
    <% if user_signed_in? %>
      <%= link_to my_interviews_path do %>
        <div class="navbar-buttons
          <%= 'navbar-buttons--active' if @controller_action == :campaigns_my_interviews %>
          ">
          <h4 title='My interviews'>My interviews</h4>
        </div>
      <% end %>

      <% if current_user.manager_or_above? %>
        <%= link_to my_team_interviews_path do %>
          <div class="navbar-buttons
            <%= 'navbar-buttons--active' if @controller_action == :campaigns_my_team_interviews %>
            ">
            <h4 title='My team interviews'>My team interviews</h4>
          </div>
        <% end %>
      <% end %>

      <% if current_user.hr_or_above? %>
        <button class="left-buttons">
          <%= link_to campaigns_path do %>
          <div class="navbar-buttons
            <%= 'navbar-buttons--active' if @show_navbar_admin.present? %>
            ">
            <h4>Admin</h4>
          </div>
          <% end %>
        </button>
      <% end %>
    <% end %>

    <%
      if current_user.manager_or_above? &&
        ![:pages_organisation, :campaigns_campaigns_report].include?(@controller_action)
    %>
      <div class="centered-item">
        <a class='btn-blue__white-border' data-toggle='modal' data-target='#newCampaign'><p>New Interview</p></a>
      </div>
    <% end %>
  </div>

  <div class="navbar-controls-right flex-row-between-centered">
    <div class="user-top-nav">
      <div class="dropdown show">
        <a class="navbar-user-card  dropdown-toggle flex-row-between-centered" href="#" role="button" id="dropdownMenuLogout" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <img src="<%= current_user.picture %>" alt="<%= current_user.fullname %>" class='avatar-sm' onerror='this.onerror=null;this.src="<%= asset_url('empty-avatar.png', type: :image) %>";'>
        </a>
        <div class="dropdown-menu dropdown-menu-right" id='dropdown-user-menu' aria-labelledby="dropdownMenuLogout">
          <div class="dropdown-card">
            <div class="user-info">
              <p><%= current_user.fullname%></p>
              <h6><%= current_user.email%></h6>
            </div>
          </div>
          <%= link_to user_path(current_user) do %>
            <div class="dropdown-card dropdown-item ">
              <div class='dropdown-card-text'>
                <h6>Profile</h6>
              </div>
            </div>
          <% end %>
          <%= link_to destroy_user_session_path, method: :delete do %>
            <div class="dropdown-card dropdown-item flex-row-between-centered">
              <div class='dropdown-card-text'>
                <h6>Log out</h6>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<% if @show_navbar_admin.present? %>
  <div class="navbar-admin">
    <% klass = 'navbar-admin__button' %>
    <% active_klass = "navbar-admin__button--active" %>

    <%= link_to campaigns_path,
      class: "#{klass} #{active_klass if @controller_action == :campaigns_index}" do %>
      <h4>Campaigns</h4>
    <% end %>

    <%= link_to interview_forms_path,
      class: "#{klass} #{active_klass if @controller_action == :interview_forms_index}" do %>
      <h4>Templates</h4>
    <% end %>

    <%= link_to organisation_path,
      class: "#{klass} #{active_klass if @controller_action == :pages_organisation}" do %>
      <h4>Employees</h4>
    <% end %>

    <%= link_to campaigns_report_path,
      class: "#{klass} #{active_klass if @controller_action == :campaigns_campaigns_report}" do %>
      <h4>Report</h4>
    <% end %>
  </div>
<% end %>

<!------------>
<!-- MODALS -->
<!------------>

<div class='modal fade' id='newCampaign' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' data-keyboard="false">
  <div class='modal-dialog' role='document' style='border-radius: 20px'>
    <%= render 'campaigns/modals/new' %>
  </div>
</div>


<!---------------->
<!-- JAVASCRIPT -->
<!---------------->

<script>
  function selectCampaignType(element) {
    document.querySelectorAll('.interview-type-card').forEach((card) => {
      card.classList.remove('selected')
    })
    document.querySelectorAll('.interview-type-card__checkbox').forEach((checkbox) => {
      checkbox.classList.remove('selected')
    })
    document.querySelectorAll('.interview_type-card__teaser').forEach((teaser) => {
      teaser.classList.remove('selected')
    })
    card = element.closest('.interview-type-card')
    checkbox = card.querySelector('.interview-type-card__checkbox')
    teaser = document.querySelector('#teaser-' + card.id.split('-')[1])
    link = element.closest('.modal').querySelector('.interview-type-cards__confirm')
    link_href = new URL(link.href)
    link_href.searchParams.set('campaign[selected_campaign_type]', element.getAttribute('data-type'))
    link.href = link_href.href
    card.classList.add('selected')
    checkbox.classList.add('selected')
    teaser.classList.add('selected')
  }
</script>
