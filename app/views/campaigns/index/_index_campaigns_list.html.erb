<% CampaignDecorator.decorate_collection(campaigns).each do |campaign| %>

  <% campaign_id = campaign.id %>
  <% manager = campaign.owner %>

  <div class="campaigns-index__list-line" id='campaign-line-<%= campaign_id %>'>
    <%= link_to '', campaign_path(campaign), class: 'stretched-link', title: campaign.title %>

    <div class="campaigns-index__list-line-element">
      <p class='template-title overflow-ellipsis font-weight-600'>
        <%= campaign.title %>
      </p>
    </div>

    <div class="campaigns-index__list-line-element">
      <div class="campaigns-index__list-line-icon">
        <span class="iconify" data-icon="<%= campaign.icon %>"></span>
      </div>
      <p><%= campaign.campaign_type_str %></p>
    </div>

    <div class="campaigns-index__list-line-element">

      <% tag_overflow = false %>

      <% campaign.tags.each_with_index do |tag, idx| %>

        <% if idx > 2 && !tag_overflow %>
          <div class="d-inline-block bkt-bg-light-blue p-3 mx-2 font-weight-600 rounded-2px">+<%= campaign.tags.count - 3 %></div>
          <% break %>
        <% else %>
          <div class="d-inline-block bkt-bg-light-blue p-3 mx-2 font-weight-600 rounded-2px"><%= tag %></div>
        <% end %>

      <% end %>

    </div>

    <div class="campaigns-index__list-line-element campaigns-index__list-element-employee">
      <p><%= campaign.employees.distinct.count %></p>
    </div>

    <div class="campaigns-index__list-line-element campaigns-index__list-element-completion">
      <p class='status-<%= campaign.completion_status %>'><%= campaign.completion_for(:all) %>%</p>
    </div>

    <% if CampaignPolicy.new(current_user, campaign).create? %>
      <div data-controller="dropdown"
           class="pos-rel d-flex justify-content-end">

        <div class="flex-row-center-centered height-2_5rem width-2_5rem-forced rounded-15px bkt-light-grey bkt-white-hover            bkt-bg-light-grey-hover cursor-pointer z-index-5 smooth-transition"
              data-action="click->dropdown#toggle dropdown:click:outside->dropdown#hide">
          <i class="fas fa-ellipsis-v"></i>
        </div>

        <div class="pos-abs rounded-5px z-index-100 bkt-box-shadow-compact d-flex flex-column align-items-start
                    bkt-bg-white bkt-dark-grey hidden"
             data-dropdown-target="menu"
             style='right: 0; top: 3rem; width: 12rem;'>

          <% unless campaign.completion_for(:all) == 100 %>

            <%= link_to send_notification_email_path(id: campaign_id),
                  class: 'width-100',
                  data: { action: 'click->dropdown#hide' },
                  remote: true do %>

              <button class="flex-row-start-centered fs-1_6rem font-weight-500 bkt-bg-light-grey10-hover
                             width-100 p-3">
                Send email
              </button>

            <% end %>

          <% end %>

          <% if CampaignPolicy.new(current_user, campaign).destroy? %>
            <%# link_to 'Delete', campaign_path(campaign), method: :delete, remote: true,
              data: {
                action: 'click->dropdown#hide'
              },
              class: 'px-3 py-2 bkt-light-grey-hover w-100' %>

            <button class='flex-row-start-centered fs-1_6rem font-weight-500 bkt-red bkt-bg-light-grey10-hover
                           width-100 pl-3 pr-3 p-3'
                    data-toggle='modal'
                    data-target='#deleteCampaign-<%= campaign_id %>'
                    data-action="click->dropdown#hide">
               Delete
            </button>

          <% end %>

        </div>

      </div>
    <% end %>

  </div>


  <!------------>
  <!-- MODALS -->
  <!------------>

  <div id='deleteCampaign-<%= campaign_id %>'
       class='modal ays-modal fade'
       tabindex='-1'
       role='dialog'
       data-keyboard="false"
       data-backdrop="static">

    <div class='modal-dialog ays-modal__dialog'
         role='document'>

      <%= render 'campaigns/modals/delete_campaign', campaign: campaign %>

    </div>

  </div>


<% end %>

<div class="paginate-container paginate-container-blue">

  <% if params.dig(:search, :page).present? && params.dig(:search, :page).to_i > 1 %>

    <div class="paginate__previous-button paginate__button-blue"
         data-action='click->change-page#previous'>
      <span class="iconify" data-icon="fontisto:angle-left"></span>
      <p>Previous</p>
    </div>

  <% end %>

  <%= paginate @campaigns, left: 3, right: 1 %>

  <% if @campaigns.count == 10 && @any_more %>

    <div class="paginate__next-button paginate__button-blue"
         data-action='click->change-page#next'>
      <p>Next</p>
      <span class="iconify" data-icon="fontisto:angle-right"></span>
    </div>

  <% end %>

</div>
