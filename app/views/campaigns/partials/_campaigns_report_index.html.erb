<div class="row">
  <% campaigns.each do |campaign| %>
    <% completion = (campaign.interviews.where(completed: true).count.fdiv(campaign.interviews.count) * 100).round %>
    <% ratings = campaign.interviews.where(label: 'Manager').map{|x| x.interview_answers.joins(:interview_question).where(interview_questions: {question_type: 'rating'}).map{|y| y.answer.to_i.fdiv(y.interview_question.options.first.first.to_i)*10 if y.answer.present?}}.flatten %>

    <div class="col-lg-4 col-md-6 col-xs-12 campaigns-report-campaign-card__container">
      <div class="campaigns-report-campaign-card" id='campaign-<%= campaign.id %>'>
        <%= link_to '', campaign_report_info_path(id: campaign.id), class: 'stretched-link', remote: true %>
        <div class="campaigns-report-campaign-card__top">
          <div class="campaigns-report-campaign-card__top-progression"><p><%= completion %>%</p></div>
          <div class="campaigns-report-campaign-card__top-title">
            <p><%= campaign.title %></p>
            <p><%= campaign.owner.fullname %></p>
          </div>
          <div class="campaigns-report-campaign-card__top-menu"></div>
        </div>
        <div class="campaigns-report-campaign-card__bottom">
          <div class="campaigns-report-campaign-card__bottom-item">
            <p>Employees</p>
            <i class="fas fa-user"></i>
            <p><%= campaign.interviews.where(label: 'Crossed').count %></p>
          </div>
          <div class="campaigns-report-campaign-card__bottom-item" data-toggle='tooltip' title='Crossed Reviews only'>
            <p>Rating</p>
            <% if current_user.company_id == 2 %>
              <i class="fas fa-pizza-slice"></i>
            <% else %>
              <i class="fas fa-star"></i>
            <% end %>
            <p><%= ratings.present? ? ratings.sum.fdiv(ratings.count) : 'N/A' %></p>
          </div>
          <div class="campaigns-report-campaign-card__bottom-item">
            <p>Questions</p>
            <i class="fas fa-question-circle"></i>
            <p><%= campaign.interview_form.interview_questions.where.not(question_type: 'separator').count %></p>
          </div>
        </div>
      </div>
      <div class="campaigns-report-campaign-card__show-summary-container hidden">
        <div class="campaigns-report-campaign-card__show-summary" id='summary-<%= campaign.id %>'>
        </div>
      </div>
    </div>
  <% end %>
