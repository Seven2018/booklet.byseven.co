<% trainings.each do |training| %>
  <% folder = training.folder %>
  <% if folder.present? %>
    <% content = folder %>
  <% else %>
    <% content = training.sessions.first.workshop %>
  <% end %>
  <div class="booklet-folder-card">
    <% start_date = training.sessions.order(date: :asc).first.date %>
    <% end_date = training.sessions.order(date: :desc).first.date %>
    <% if start_date >= Date.today %>
      <div class="tab-date__start tab-date--green">
        <p><%= start_date.strftime('%d.%m.%Y') %></p>
      </div>
    <% else %>
      <div class="tab-date__start tab-date--red">
        <p><%= start_date.strftime('%d.%m.%Y') %></p>
      </div>
    <% end %>
    <% unless end_date.nil? %>
      <% if end_date >= Date.today %>
        <div class="tab-date__end tab-date--green">
          <p><%= end_date.strftime('%d.%m.%Y') %></p>
        </div>
      <% else %>
        <div class="tab-date__end tab-date--red">
          <p><%= end_date.strftime('%d.%m.%Y') %></p>
        </div>
      <% end %>
    <% end %>
    <div class="booklet-folder-card-top booklet-card-top">
      <div class="booklet-folder-card__top-info">
        <div>
          <i class="fas fa-folder"></i>
          <h3 data-toggle='tooltip' title='<%= content.title %>'><b><%= content.title %></b></h3>
        </div>
        <div>
          <p class='booklet-folder-card__duration'><%= TimeConversion.convert(content.duration) %></p>
          <% if (folder.present? && content.children_contents.map{|x| x.content_type}.include?('Synchronous')) || (!folder.present? && content.content_type == 'Synchronous') %>
            <div class="booklet-folder-card-type-icon">
              <i class="fas fa-chalkboard-teacher" style='color:rgba(91, 146, 197, 1);'></i>
              <p style='color:rgba(91, 146, 197, 1);'>In Person</p>
            </div>
          <% end %>
          <% if (folder.present? && content.children_contents.map{|x| x.content_type}.include?('Asynchronous')) || (!folder.present? && content.content_type == 'Asynchronous') %>
            <div class="booklet-folder-card-type-icon">
              <i class="fas fa-laptop" style='color:rgba(91, 146, 197, 1);'></i>
              <p style='color:rgba(91, 146, 197, 1);'>Online</p>
            </div>
          <% end %>
        </div>
      </div>

      <div class="booklet-folder-card__categories">
        <% unless folder.nil? %>
          <% folder_categories = folder.categories.first(3) %>
          <% folder_categories.each do |category| %>
            <div class="booklet-folder-card__category-pill">
              <p><%= category.title %></p>
            </div>
          <% end %>
          <% content_categories = folder.children_categories.first(3 - folder_categories.count) %>
          <% content_categories.each do |category| %>
            <div class="booklet-content-card__category-pill">
              <p><%= category.title %></p>
            </div>
          <% end %>
        <% end %>
      </div>

      
    </div>
    <div class="booklet-folder-card-bottom">
      <div class="recommendation-card__bottom-data">
        <i class="fas fa-users"></i>
        <% attendees = training.sessions.map{|x| x.attendees.count}.max %>
        <p><%= attendees %></p>
      </div>
      <div class="recommendation-card__bottom-data">
        <i class="fas fa-folder"></i>
        <% if folder.present? %>
          <p><%= folder.children_folders.count %></p>
        <% else %>
          <p>0</p>
        <% end %>
      </div>
      <div class="recommendation-card__bottom-data">
        <i class="fas fa-file"></i>
        <% if folder.present? %>
          <p><%= folder.children_contents.count %></p>
        <% else %>
          <p>1</p>
        <% end %>
      </div>
      <div class="recommendation-card__bottom-data">
        <i class="fas fa-euro-sign"></i>
        <% cost = training.sessions.map{|y| y.cost.nil? ? 0 : y.cost}.sum / attendees%>
        <p><%= '%0d' % cost %>â‚¬ (cost/employee)</p>
      </div>
    </div>
  </div>
<% end %>
