
  <div class="interview-question__form">
    <div class="flex-row-between-centered">
      <h3 ><%= j %>/ <%= question.question %></h3>
      <% if question.required %>
        <i class="fas fa-asterisk" data-toggle='tooltip' title='Required'></i>
      <% end %>
    </div>

    <% existing_answer =
      InterviewAnswer.find_by(
      interview: @interview,
      interview_question: question,
      user: current_user
    ) %>
    <% if existing_answer.nil? && @interview.crossed? %>
      <% existing_answer =
        InterviewAnswer.find_by(
        interview: @interview.campaign.hr_interview,
        interview_question: question,
        user: @interview.campaign.owner
      ) %>
    <% elsif @interview.employee? && read_only %>
      <% existing_answer =
        InterviewAnswer.find_by(
        interview: @interview,
        interview_question: question,
        user: @interview.employee
      ) %>
    <% end %>

    <% current_answer   = existing_answer.present? ? existing_answer.answer   : '' %>
    <% current_comments = existing_answer.present? ? existing_answer.comments : '' %>

    <%= simple_form_for :interview_answer, url: answer_interview_question_path, remote: true do |f| %>
      <% if question.open_question? %>
        <%= f.input(
            :answer,
            as: :text,
            label: false,
            input_html: {
              value: current_answer,
              onkeyup: 'enableNext(this);'
            },
            disabled: read_only
          ) %>

      <% elsif question.rating? %>

        <fieldset class="rating<%= ' read_only' if read_only %>">
          <% for i in 1..question.options.keys.first.to_i %>
            <% stars_count = question.options.keys.first.to_i - i + 1 %>
            <input
              type="radio"
              class='radio-rating <%= rand(1000) %>'
              id="star-position(<%= question.position %>)-<%= i %>"
              name="interview_answer[answer]"
              value="<%= stars_count%>"
              onchange="selectRating(this);enableNext(this);"
              <% if current_answer.to_i == stars_count %> checked <% end %>
              <%= 'disabled' if read_only %>
            />
            <label
              class="full"
              for="star-position(<%= question.position %>)-<%= i %>"
              title="<%= stars_count %> stars"
            ><%= stars_count %></label>
          <% end %>
        </fieldset>

        <%= f.input(
          :comments,
          as: :text,
          input_html: {
            value: current_comments
          },
          required: false,
          disabled: read_only
        ) if question.allow_comments %>

      <% elsif question.mcq? %>

        <fieldset class="mcq">
          <%= f.collection_radio_buttons(:answer, question.options.keys.map{|c| [c, c]}, :first, :last) do |b| %>
            <label class="rad-label">
              <% if b.text == current_answer %>
                <%= b.radio_button class: 'rad-input', checked: 'checked', onchange: 'enableNext(this);', disabled: read_only %>
              <% else %>
                <%= b.radio_button class: 'rad-input' , onchange: 'enableNext(this);', disabled: read_only %>
              <% end %>
              <div class="rad-design"></div>
              <div class="rad-text"><%= b.text %></div>
            </label>
          <% end %>
        </fieldset>

      <% end %>

        <%= f.hidden_field :interview_id, value: @interview.id %>
        <%= f.hidden_field :interview_question_id, value: question.id %>
      <%= f.submit '', class: 'hidden-submit hidden' %>
    <% end %>

  </div>

  <div class="interview-question__controls">
    <% if @interview.crossed? %>
      <button class="btn-blue" onclick='goToQuestion(this, "summary");'><p>Summary</p></button>
    <% else %>
      <button class="btn-blue" onclick='previousQuestion(this);'><p>Previous</p></button>
    <% end %>
    <% if j == questions.where.not(question_type: 'separator').count && read_only %>
      <%= link_to campaign_path(@interview.campaign, employee_id: @interview.employee_id) do %>
        <button class="btn-blue"><p>Validate</p></button>
      <% end %>
    <% elsif j == questions.where.not(question_type: 'separator').count && @interview.completed == true %>
      <button class="btn-blue btn-blue" onclick='submitAnswers(this)'><p>See Summary</p></button>
    <% elsif j == questions.where.not(question_type: 'separator').count && question.required && current_answer == '' %>
      <button class="btn-blue btn-blue-disabled" onclick='submitAnswers(this)' disabled><p>Submit Form</p></button>
    <% elsif j == questions.where.not(question_type: 'separator').count %>
      <button class="btn-blue" onclick='submitAnswers(this)'><p>Submit Form</p></button>
    <% elsif question.required && current_answer == '' && !read_only %>
      <button class="btn-blue btn-blue-disabled" onclick='nextQuestion(this);' disabled><p>Next</p></button>
    <% else %>
      <button class="btn-blue" onclick='nextQuestion(this);'><p>Next</p></button>
    <% end %>
  </div>
