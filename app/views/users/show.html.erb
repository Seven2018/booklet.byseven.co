<div id="show-controls" class='flex-row-between-centered'>
  <%= link_to organisation_path, class: 'btn return-arrow' do %><i class="fas fa-arrow-left"></i><% end %>
  <div id='show-buttons'>
    <% if current_user.access_level == 'Super Admin' || @user == current_user || (['Admin', 'HR'].include?(current_user.access_level) && current_user.company == @user.company) %>
      <a data-toggle='modal' data-target='#editUser'><button class='btn-edit-white btn-edit-icon'><i class='fas fa-pen'></i></button></a>
      <a data-toggle='modal' data-target='#editPassword'><button class='btn-edit-white btn-edit-icon btn-last'><i class="fas fa-key"></i></button></a>
    <% end %>
  </div>
</div>
<div id='container-show-user'>
  <div class="user-top">
    <div class="user-photo">
      <% if @user.picture.present? %>
        <img src='<%= @user.picture %>' alt="" class='avatar-xlarge' onerror='this.onerror=null;this.src="<%= asset_url('empty-avatar.png', type: :image) %>";'>
      <% else %>
        <a data-toggle='modal' data-target='#editPicture' class="avatar-xlarge-empty centered-item">
          <h6>Add picture</h6>
        </a>
      <% end %>
    </div>
    <div class="user-information">
      <div class="user-top-info">
        <div class='user-name'>
          <p><strong><%=  @user.firstname %></strong></p>
          <p><strong><%=  @user.lastname %></strong></p>
        </div>
        <div class='user-contact-info'>
          <p><%=  @user.email %></p>
          <p class="data" id='phone' onclick='openForm(this)'><%=  @user.phone_number if @user.phone_number.present? %></p>
          <%= simple_form_for :user, url: user_path(@user, page: 'show', type: 'phone'), html: { class: "hidden hidden-form" }, method: :patch, remote: true, input_html: {multipart: true} do |f| %>
            <%= f.input :phone_number, label: false, input_html: {value: @user.phone_number} %>
            <%= button_tag type: 'submit', class: 'hidden hidden-submit' %>
          <% end %>
        </div>
      </div>
      <div class="user-access">
        <p>Access Level:</p>
        <p><%=  @user.access_level %></p>
      </div>
      <div class="user-job">
        <p>Job Title:</p>
        <p class="data" id='job' onclick='openForm(this)'><%=  @user.job_description if @user.job_description.present? %></p>
        <%= simple_form_for :user, url: user_path(@user, page: 'show', type: 'job'), html: { class: "hidden hidden-form" }, method: :patch, remote: true, input_html: {multipart: true} do |f| %>
          <%= f.input :job_description, label: false, input_html: {value: @user.job_description} %>
          <%= button_tag type: 'submit', class: 'hidden hidden-submit' %>
        <% end %>
      </div>
<!--       <div class="user-linkedin">
        <p>Linkedin:</p>
        <p>
          <% if @user.linkedin.present? %>
            <%= link_to @user.linkedin do %><i class="fab fa-linkedin-in"></i><% end %>
          <% end %>
        </p>
      </div> -->
      <div class="user-birth">
        <p>Birth date:</p>
        <p class="data" id='birth_date' onclick='openForm(this)'><%=  @user&.birth_date %></p>
        <%= simple_form_for :user, url: user_path(@user, page: 'show', type: 'birth_date'), html: { class: "hidden hidden-form" }, method: :patch, remote: true, input_html: {multipart: true} do |f| %>
          <%= f.input :birth_date, label: false, input_html: {class: 'datepicker'}, default: @user.birth_date %>
          <%= button_tag type: 'submit', class: 'hidden hidden-submit' %>
        <% end %>
      </div>
      <div class="user-hire">
        <p>Hire date:</p>
        <p class="data" id='hire_date' onclick='openForm(this)'><%=  @user.hire_date if @user.hire_date.present? %></p>
        <%= simple_form_for :user, url: user_path(@user, page: 'show', type: 'hire_date'), html: { class: "hidden hidden-form" }, method: :patch, remote: true, input_html: {multipart: true} do |f| %>
          <%= f.input :hire_date, label: false, input_html: {class: 'datepicker'}, default: @user.hire_date %>
          <%= button_tag type: 'submit', class: 'hidden hidden-submit' %>
        <% end %>
      </div>
    </div>
  </div>
  <div class="user-trainings">
    <h2>Upcoming Trainings</h2>
    <div class="upcoming-trainings">
      <div class="upcoming-trainings-card">
        <div class="user-training-title">
          <h3><b>Just a test to see what would happen if the title was absurdly long maybe this isnt long enough</b></h3>
        </div>
        <p>Workshop Date</p>
        <p>Workshop Duration</p>
      </div>
    </div>
    <h2>Completed Trainings</h2>
    <div class="completed-trainings">
      <div class="completed-trainings-card">
        <div class="user-training-title">
          <h3><b>Just a test to see what would happen if the title was absurdly long maybe this isnt long enough</b></h3>
        </div>
        <p>Workshop Date</p>
        <p>Workshop Duration</p>
      </div>
    </div>
  </div>
<div>
  <% Assessment.joins(:user_forms).where(user_forms: {user_id: @user.id}).each do |form| %>
   <p><%= form.title %></p>
   <p>Grade : <%= UserForm.find_by(user_id: @user, mod_id: form.id)&.grade %>%</p>
  <% end %>
</div>

<!-- Modal -->
<div class="modal fade" id="editUser" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document" style="border-radius: 20px">
    <%= render 'edit', user: @user %>
  </div>
</div>

<div class="modal fade" id="editPicture" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document" style="border-radius: 20px">
    <%= render 'edit_picture', user: @user %>
  </div>
</div>

<div class="modal fade" id="editPassword" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document" style="border-radius: 20px">
    <%= render 'changepassword', user: @user %>
  </div>
</div>


<% if ['Super Admin', 'Admin', 'HR'].include?(current_user.access_level) %>
  <script>
    function openForm(element) {
      form = element.parentNode.querySelector('.hidden-form');
      element.classList.toggle('hidden');
      form.classList.toggle('hidden');
    };
  </script>
<% end %>
