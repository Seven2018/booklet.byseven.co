<% form_title = {
  'separator' => question.question,
  'open_question' => 'Open Question',
  'rating' => 'Rating',
  'mcq' => 'MCQ',
  'objective' => 'Objective'
} %>

<% question_icon = {
  'open_question' => 'fas fa-question-circle',
  'rating' => 'fas fa-star-half-alt',
  'mcq' => 'far fa-check-square',
  'objective' => 'fas fa-bullseye'
} %>

<% first_question = question.position == 1 %>
<% last_question = question.position >= template.interview_questions.count %>

<div class="line-top">

  <div class="line-title <%= 'line-title-separator' if question.separator? %>"
       onclick='toggleMod(this);'>
    <i class="fas fa-angle-down" data-rotated='0'></i>
    <% unless question.separator? %>
      <i class="<%= question_icon[question.question_type] %>"></i>
    <% end %>
    <p title='<%= question.question %>'><%= question.question %></p>
  </div>

  <div class="line-controls">
    <% if current_user.hr_or_above? && !params[:content_access].present? %>

      <% if first_question %>
        <a disabled class="line-move-up" style='cursor: default;'>
          <i class="fas fa-arrow-up" style='color:#5B5959;'></i>
        </a>
      <% else %>
        <%= link_to move_up_interview_question_path(question), class: 'line-move-up', remote: true do %>
          <i class="fas fa-arrow-up"></i>
        <% end %>
      <% end %>

      <% if last_question %>
        <a disabled class="line-move-down" style='cursor: default;'>
          <i class="fas fa-arrow-down" style='color:#5B5959;'></i>
        </a>
      <% else %>
        <%= link_to move_down_interview_question_path(question), class: 'line-move-down', remote: true do %>
          <i class="fas fa-arrow-down"></i>
        <% end %>
      <% end %>

      <%= link_to interview_question_path(question), method: :delete, class: 'line-delete', data: {confirm: 'Are you sure ?'}, remote: true do %>
        <i class="far fa-trash-alt" id='line-delete' data-toggle='tooltip' title='Delete'></i>
      <% end %>

    <% end %>
  </div>

</div>

<%= simple_form_for question, remote: true do |f| %>

  <% unless question.separator? %>
    <div class="flex-row-between-centered">
      <label>Question</label>
      <div class="flex-row-between-centered">
        <div class="visible-for-question">
          <label>Visible for</label>
          <%= f.input(:visible_for,
            as: :select,
            collection: InterviewQuestion::visible_fors.keys,
            label_method: lambda {|k| k.capitalize},
            label: false,
            include_blank: false,
            input_html: {
              onchange: 'saveQuestion(this);'
            }
          ) %>
        </div>
        <div class="required-question-switch-container">
          <label>Required</label>
          <label class="required-question-switch switch_checked">
            <input type="checkbox"
                   name='interview_question[required]'
                   onclick='switchSide(this);'
                   checked
            />
            <div><%# do not remove %></div>
          </label>
        </div>
      </div>
    </div>
  <% end %>

  <%= f.input(:question, {
      placeholder: '*Required',
      input_html: {
        autocomplete: 'off',
        onclick: 'saveQuestion(this)'
      },
      required: true,
      label: (question.separator? ? 'Title' : false )
    }.compact) %>

  <%# f.input :description,
      as: :text,
      placeholder: 'Description (optional)',
      input_html: {
        value: question.description,
        onclick: 'saveQuestion(this)'
      }
      %>

  <%= f.input :description,
      as: :trix_editor,
      placeholder: 'Description (optional)',
      input_html: {
        value: question.description
      }
      %>

  <% if question.rating? %>
    <div class="add-rating__select">
      <%= f.input(:options,
        as: :select,
        collection: (1..10),
        label: 'Max rating',
        input_html: {
          onchange: 'saveQuestion(this); setRating(this);'
        },
        selected: question.options.keys.first
      ) %>
    </div>
    <div class="show-rating">
      <% question.options.keys.first.to_i.times do %>
        <i class="far fa-star"></i>
      <% end %>
    </div>
  <% end %>
  <% if ['rating', 'mcq', 'objective'].include?(question.question_type) %>
    <div class="add-rating__toggle">
      <%= f.input(
        :allow_comments,
        label: 'Allow comments',
        input_html: {
          onclick: 'this.closest("form").querySelector(".hidden-submit").click();',
          autocomplete: 'off'
        }
      ) %>
    </div>
  <% end %>

  <%= f.submit '', class: 'hidden-submit hidden' %>
<% end %>

<% if question.mcq? || question.objective? %>
  <label>Options</label>
  <div id='mcq-<%= question.id %>'>
    <%= render 'interview_forms/partials/show_mcq', question: question, page: 'edit' %>
  </div>
<% end %>
